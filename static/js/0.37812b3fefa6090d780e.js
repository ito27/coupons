webpackJsonp([0,2,3],{UheU:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("woOf"),a=n.n(i),r=n("Xxa5"),o=n.n(r),s=n("fZjL"),u=n.n(s),l=n("exGp"),c=n.n(l),d=n("Dd8w"),p=n.n(d),m=n("SSY3"),v=n("NYxO"),f=n("v/PK"),_=n("l1U8"),h={name:"CouponForm",data:function(){return{coupon:[{name:"id",type:"number",prepend:"優惠代號",placeholder:"輸入代號",value:null,disabled:!1,min:0,check:!0,required:!0},{name:"img_url",type:"url",prepend:"圖檔連結",placeholder:"上傳新圖片或填入imgur圖片連結",value:null,disabled:!0,required:!0},{name:"expiration",type:"date",prepend:"到期日",placeholder:"",value:null,disabled:!0,required:!0},{name:"price",type:"number",prepend:"價格",placeholder:"",value:null,disabled:!0,min:0,required:!0},{name:"name",type:"text",prepend:"優惠名稱",placeholder:"例：KFC全國優惠券...等",value:null,disabled:!0,required:!1},{name:"restriction",type:"text",prepend:"使用限制",placeholder:"例：限桶餐加購...等",value:null,disabled:!0,required:!1}],img_upload_result:{link:null,deletehash:null},items:[],data_uploaded:!1,img_upload_mode:!1,last_upload:{coupon_id:null,show:!1},coupon_exist:!1,isUploading:!1}},components:{ImageUploader:f.default,ItemForm:_.default},computed:p()({},Object(v.d)(["userInfomation"]),{ifDisabled:function(){return!this.ifCorrectlink||!this.ifCorrectForm||this.coupon_exist||0===this.items.length},ifCorrectlink:function(){var e="";return this.coupon[1].value&&(e=this.coupon[1].value),e.startsWith("https://i.imgur.com/")},ifCorrectForm:function(){var e=[];return this.coupon.forEach(function(t){var n=null;n=!t.required||null!==t.value&&""!==t.value,e.push(n)}),!e.includes(!1)}}),methods:{clearData:function(){this.coupon.forEach(function(e){return e.value=null}),this.items=[]},checkExist:function(){var e=c()(o.a.mark(function e(t){var n,i=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(""===t){e.next=6;break}return e.next=3,m.b.fs(t);case 3:return n=e.sent,function(e){e?(i.coupon_exist=!0,u()(e).forEach(function(t){var n=i.coupon.findIndex(function(e){return e.name===t});i.coupon[n]&&(i.coupon[n].value=e[t])})):(i.coupon_exist=!1,i.items=[],i.coupon.forEach(function(e){e.value=null,e.disabled=!1}),i.coupon[0].value=t,i.coupon[1].value=i.img_upload_result.link)}(n),e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),addInfo:function(){var e=c()(o.a.mark(function e(t){var n,i=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return null,n={},t.forEach(function(e){e.value&&(n[e.name]=e.value)}),a()(n,{userId:this.userInfomation.uid},{userName:this.userInfomation.displayName},{foods:this.items},{deletehash:this.img_upload_result.deletehash}),e.next=6,this.checkExist(n.id);case 6:if(e.sent){e.next=12;break}return e.next=10,m.b.fs(""+t[0].value,n,"POST");case 10:e.sent,i.isUploading=!1,i.data_uploaded=!0,i.last_upload.show=!0,setTimeout(function(){i.last_upload.show=!1},5e3),i.img_upload_mode=!1,i.last_upload.coupon_id=i.coupon[0].value,i.items=[],void u()(i.coupon).forEach(function(e){i.coupon[e].value=null});case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}},b={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.userInfomation?n("div",[n("b-card",{staticStyle:{"max-width":"30rem"},attrs:{"no-body":""}},[n("div",{attrs:{slot:"header"},slot:"header"},[n("b-alert",{attrs:{variant:"danger",dismissible:"",show:e.img_upload_mode},on:{dismissed:function(t){e.img_upload_mode=!1}}},[n("Image-uploader",{on:{"set-result":function(t){e.img_upload_result=t,e.coupon[1].value=t.link}}})],1),e._v(" "),e.img_upload_mode||e.ifCorrectlink?e._e():n("b-button",{attrs:{variant:"outline-primary"},on:{click:function(t){e.img_upload_mode=!0}}},[e._v("上傳新圖片至imgur")])],1),e._v(" "),e.img_upload_result.link||e.ifCorrectlink?n("div",{attrs:{slot:"header"},slot:"header"},[e.coupon[1].value?n("b-img",{attrs:{thumbnail:"",fluid:"",src:e.coupon[1].value}}):e._e(),e._v(" "),n("p",[e._v(e._s(e.coupon[1].value))])],1):e._e(),e._v(" "),n("b-alert",{attrs:{slot:"header",variant:"danger",show:e.coupon_exist},slot:"header"},[e._v("\r\n        券號已存在\r\n      ")]),e._v(" "),n("b-table",{attrs:{items:e.coupon,fields:[{key:"name",label:""}]},scopedSlots:e._u([{key:"name",fn:function(t){return[n("b-input-group",{attrs:{prepend:t.item.prepend,size:"md"}},[n("b-form-input",{directives:[{name:"b-popover",rawName:"v-b-popover.hover.bottom",value:t.item.required?"":"選填",expression:"row.item.required ? '':'選填'",modifiers:{hover:!0,bottom:!0}}],attrs:{type:t.item.type,placeholder:t.item.placeholder,disabled:t.item.disabled},on:{change:function(n){t.item.check&&e.checkExist(t.item.value)}},model:{value:t.item.value,callback:function(n){e.$set(t.item,"value",n)},expression:"row.item.value"}})],1)]}}])}),e._v(" "),!1===e.coupon_exist?n("div",[n("item-form",{attrs:{"item-list":e.items},on:{"set-item-result":function(t){e.items=t}}})],1):e._e(),e._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("b-button",{attrs:{disabled:e.ifDisabled,variant:e.ifDisabled?"":"success"},on:{click:function(t){e.addInfo(e.coupon),e.isUploading=!0}}},[e._v("登錄")]),e._v(" "),n("b-button",{attrs:{variant:"danger"},on:{click:function(t){e.clearData()}}},[e._v("清除重填")]),e._v(" "),e.last_upload.show?n("b-alert",{attrs:{variant:"success",dismissible:"",show:""},on:{dismissed:function(t){e.last_upload.show=!1}}},[e._v("\r\n            券號"+e._s(e.last_upload.coupon_id)+"資料已登錄，感謝您的貢獻\r\n        ")]):n("b-alert",{attrs:{variant:"danger",show:e.coupon_exist||0===e.items.length||!e.ifCorrectForm||!e.ifCorrectlink}},[e.isUploading?n("div",[n("div",[e._v("優惠券"+e._s(e.coupon[0].value)+"上傳中...")])]):n("div",[e.coupon_exist?n("div",[e._v("券號已存在")]):e._e(),e._v(" "),0===e.items.length?n("div",[e._v("商品清單未登錄")]):e._e(),e._v(" "),e.ifCorrectForm?e._e():n("div",[e._v("資料不完整")]),e._v(" "),e.ifCorrectlink?e._e():n("div",[e._v("圖片連結錯誤")])])])],1)],1)],1):n("div",[e._v("\r\n    使用Google登入後，即可協助新增優惠券\r\n  ")])])},staticRenderFns:[]},g=n("VU/8")(h,b,!1,null,null,null);t.default=g.exports},l1U8:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("woOf"),a=n.n(i),r={name:"ItemForm",props:{itemList:{type:Array,default:function(){return[]}}},data:function(){return{collections:[],area_show:!1,exist_alert:!1,itemList_fields:[{key:"name",label:"名稱"},{key:"amount",label:"數量"},{key:"action",label:""}],input:{text:"",amount:null}}},methods:{select:function(e){this.input.text=e},addToList:function(){var e=this;""!==this.input.text&&(-1===this.itemList.findIndex(function(t){return t.name===e.input.text})?(this.exist_alert=!1,this.itemList.push(a()({},{name:this.input.text,amount:this.input.amount}))):this.exist_alert=!0);this.$emit("set-item-result",this.itemList),this.clearInput()},clearInput:function(){for(var e in this.input)this.input[e]=null},removeFromList:function(e){var t=this.itemList.findIndex(function(t){return t.name===e.name});-1!==t&&this.itemList.splice(t,1)}}},o={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b-alert",{attrs:{show:""}},[n("b-btn",{on:{click:function(t){e.area_show=!e.area_show}}},[e._v(e._s(e.area_show?"收合":"展開"))]),e._v(" "),n("span",[e._v("\n      商品清單\n    ")]),e._v(" "),!1===e.area_show?n("span",[e._v("\n      ...  "+e._s(e.itemList.length)+" 件商品\n    ")]):e._e()],1),e._v(" "),!0===e.area_show?n("div",[e.itemList.length>0?n("div",[n("b-table",{attrs:{items:e.itemList,fields:e.itemList_fields},scopedSlots:e._u([{key:"action",fn:function(t){return[n("b-button",{staticClass:"mr-1",attrs:{size:"sm"},on:{click:function(n){n.stopPropagation(),e.removeFromList(t.item)}}},[e._v("\n            移除\n          ")])]}}])})],1):n("div",[n("p",[e._v("清單內沒有商品")])]),e._v(" "),n("div",[n("b-card",{attrs:{"no-body":""}},[n("b-alert",{attrs:{variant:"danger",dismissible:"",show:e.exist_alert},on:{dismissed:function(t){e.exist_alert=!1}}},[e._v("已在清單上")]),e._v(" "),n("b-tabs",{attrs:{pills:"",card:"",vertical:"","nav-wrapper-class":"w-20"}},e._l(e.collections,function(t,i){return n("b-tab",{key:i,attrs:{title:t.name}},e._l(t.items,function(t,i){return n("b-btn",{key:i,attrs:{variant:"outline-success"},on:{click:function(n){e.select(t)}}},[e._v(e._s(t))])}))}))],1),e._v(" "),n("b-input-group",[n("h4",[e._v("名稱")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.input.text,expression:"input.text"}],attrs:{type:"text"},domProps:{value:e.input.text},on:{input:function(t){t.target.composing||e.$set(e.input,"text",t.target.value)}}}),e._v(" "),n("b-btn",{on:{click:e.clearInput}},[e._v("x")])],1),e._v(" "),n("b-input-group",[n("h4",[e._v("數量")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.input.amount,expression:"input.amount"}],attrs:{type:"number",min:"0"},domProps:{value:e.input.amount},on:{input:function(t){t.target.composing||e.$set(e.input,"amount",t.target.value)}}})]),e._v(" "),n("b-btn",{attrs:{disabled:""===e.input.text||!e.input.amount,variant:"success"},on:{click:e.addToList}},[e._v("增加至商品清單")])],1)]):e._e()],1)},staticRenderFns:[]},s=n("VU/8")(r,o,!1,null,null,null);t.default=s.exports},"v/PK":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("Xxa5"),r=n.n(a),o=n("fZjL"),s=n.n(o),u=n("exGp"),l=n.n(u),c=n("//Fk"),d=n.n(c),p=this,m=(i=l()(r.a.mark(function e(t,n){var i,a,o,s,u;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i="5b2f0a2e116e9b0",a="https://api.imgur.com/3/image",o=null,"POST"!==t){e.next=11;break}return e.next=6,v(n);case 6:return s=e.sent,u=s.split(","),e.next=10,u[1].toString();case 10:o=e.sent;case 11:return e.abrupt("return",fetch("POST"===t?a:a+"/"+n,{body:""+("POST"===t?o:""),cache:"no-cache",credentials:"same-origin",headers:{Authorization:"Client-ID "+i,Accept:"multipart/form-data"},method:t,mode:"cors"}).then(function(e){return e.json()}).catch(function(e){return console.error(e)}));case 12:case"end":return e.stop()}},e,p)})),function(e,t){return i.apply(this,arguments)});function v(e){var t=new FileReader;return new d.a(function(n,i){t.onerror=function(){t.abort(),i("load file fail")},t.onload=function(){n(t.result)},t.readAsDataURL(e)})}var f,_={readFile:(f=l()(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",v(t));case 1:case"end":return e.stop()}},e,p)})),function(e){return f.apply(this,arguments)}),uploadFile:function(e){return m("POST",e)},deleteFile:function(e){return m("DELETE",e)}},h=(n("NYxO"),{name:"ImageUploader",data:function(){return{image:null,image_url:null,image_show:!0,isLoading:!1,upload_result:{link:null,deletehash:null}}},methods:{uploadImage:function(){var e=l()(r.a.mark(function e(t){var n,i=this;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.isLoading=!0,e.next=3,_.uploadFile(t);case 3:!0===(n=e.sent).success&&(this.isLoading=!1,s()(this.upload_result).forEach(function(e){return i.upload_result[e]=n.data[e]}),this.$emit("set-result",this.upload_result));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),deleteImage:function(){var e=l()(r.a.mark(function e(){var t=this;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.deleteFile(this.upload_result.deletehash);case 2:!0===e.sent.success&&(s()(this.upload_result).forEach(function(e){return t.upload_result[e]=null}),this.$emit("set-result",{link:null,deletehash:null}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),onFileChange:function(e){var t=this,n=e.target.files||e.dataTransfer.files;n.length&&_.readFile(n[0]).then(function(e){t.image_url=e})}}}),b={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b-form-file",{attrs:{placeholder:"選擇圖片",accept:"image/*",state:Boolean(e.image)},on:{change:e.onFileChange},model:{value:e.image,callback:function(t){e.image=t},expression:"image"}}),e._v(" "),e.image?n("div",[n("b-btn",{on:{click:function(t){e.image_show=!e.image_show}}},[e._v(e._s(e.image_show?"關閉預覽":"開啟預覽"))]),e._v(" "),e.image_show?n("b-img",{attrs:{src:e.image_url}}):e._e()],1):e._e(),e._v(" "),n("div",[n("b-button",{attrs:{disabled:!e.image,variant:e.image?"success":""},on:{click:function(t){e.uploadImage(e.image)}}},[e._v(e._s(e.isLoading?"上傳中...":"上傳到 imgur"))]),e._v(" "),e.upload_result.link?n("b-button",{on:{click:e.deleteImage}},[e._v("取消上傳")]):e._e()],1)],1)},staticRenderFns:[]},g=n("VU/8")(h,b,!1,null,null,null);t.default=g.exports}});