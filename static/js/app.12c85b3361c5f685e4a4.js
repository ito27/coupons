webpackJsonp([5],{"1/oy":function(t,n){},"9M+g":function(t,n){},GfHa:function(t,n){},Id91:function(t,n){},Jmt5:function(t,n){},NHnr:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={};e.d(r,"fetchItems",function(){return Y}),e.d(r,"queryCouponById",function(){return $}),e.d(r,"addNewCoupon",function(){return K}),e.d(r,"signOut",function(){return tt}),e.d(r,"loginWithGoogleAuth",function(){return nt}),e.d(r,"reportCouponError",function(){return et}),e.d(r,"checkUser",function(){return rt});var o=e("7+uW"),a=e("Dd8w"),u=e.n(a),i=e("/ocq");o.a.use(i.a);var s=function(){return e.e(0).then(e.bind(null,"UheU"))},c=function(){return e.e(1).then(e.bind(null,"xQGZ"))},p=["ImageUploader","ItemForm"],l=[{key:"CouponForm",name:"登錄優惠券"},{key:"CouponTable",name:"優惠券列表"}];var f=new i.a({routes:[{path:"/",component:c},{path:"/CouponTable",component:c},{path:"/CouponForm",component:s}]}),h=e("NYxO"),d={name:"navibar",data:function(){return{components:p,pages:l}},mounted:function(){this.init()},computed:u()({},Object(h.c)(["userInfomation","alertMessage"])),methods:u()({},Object(h.b)(["loginWithGoogleAuth","signOut","checkUser"]),{init:function(){var t=this;setTimeout(function(){t.checkUser()},1e3)}})},v={render:function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("b-navbar",{attrs:{fixed:"top",variant:"light",sticky:""}},[e("b-navbar-nav",{staticClass:"mr-auto"},[e("b-dropdown",{attrs:{id:"ddown-left",text:"功能表"}},t._l(t.pages,function(n){return e("b-dropdown-item",{key:n.key,attrs:{to:"/"+n.key}},[t._v("\n        "+t._s(n.name)+"\n      ")])}))],1),t._v(" "),e("b-navbar-nav",{staticClass:"ml-auto"},[t.userInfomation?e("b-nav-item",[t._v("\n      "+t._s(t.userInfomation.displayName)+"\n      "),e("b-btn",{attrs:{variant:"outline-danger"},on:{click:function(n){t.signOut()}}},[t._v("登出")])],1):e("b-nav-item",[e("b-btn",{attrs:{variant:"outline-success"},on:{click:function(n){t.loginWithGoogleAuth()}}},[t._v("Google登入")])],1),t._v(" "),t.alertMessage?e("b-alert",{attrs:{show:""}},[t._v(t._s(t.alertMessage.message))]):t._e()],1)],1)},staticRenderFns:[]},m={name:"App",components:{navibar:e("VU/8")(d,v,!1,null,null,null).exports}},g={render:function(){var t=this.$createElement,n=this._self._c||t;return n("div",{attrs:{id:"app"}},[n("navibar"),this._v(" "),n("router-view")],1)},staticRenderFns:[]};var E,b,_=e("VU/8")(m,g,!1,function(t){e("jFNt")},null,null).exports,w=e("bOdI"),k=e.n(w),y=(E={},k()(E,"STORE_COUPONS",function(t,n){t.coupons=n}),k()(E,"CHANGE_UPLOAD_RESULT",function(t,n){t.uploadResult=n}),k()(E,"SET_ALERTMESSAGE",function(t,n){t.alertMessage=n,setTimeout(function(){t.alertMessage=null},5e3)}),k()(E,"SET_USERINFO",function(t,n){n?(t.userInfomation=n,t.login=!0):(t.userInfomation=null,t.login=!1)}),E),S=e("2aIq"),x=e.n(S),A=e("Xxa5"),I=e.n(A),O=e("woOf"),T=e.n(O),U=e("fZjL"),G=e.n(U),R=e("exGp"),N=e.n(R),M=e("Zrlr"),C=e.n(M),F=e("wxAW"),L=e.n(F),j=e("yviF"),W=e.n(j),P=(e("dih4"),e("881v"),b={config:{apiKey:"AIzaSyD7j-RBwWtmLkk0AYCuk5MXnB8GaxBPqHE",authDomain:"coupons-b668a.firebaseapp.com",databaseURL:"https://coupons-b668a.firebaseio.com",projectId:"coupons-b668a"}}.config,W.a.initializeApp(b),W.a);P.firestore().settings({timestampsInSnapshots:!0});var q,B,H,D,z,J=function(){function t(n){C()(this,t),this.name=n,this.collection=P.firestore().collection(n)}return L()(t,[{key:"getAll",value:function(){return this.collection.get()}},{key:"setError",value:function(t){var n={error_reporter:P.auth().currentUser.uid,error_status:!0};return this.collection.doc(t).update(n)}},{key:"queryById",value:function(t){return this.collection.where("id","==",t).get()}},{key:"addNew",value:function(t){return this.collection.add(t)}}]),t}(),Z=function(){function t(){C()(this,t),this.provider=new W.a.auth.GoogleAuthProvider,this.auth=P.auth()}return L()(t,[{key:"authWithGoogle",value:function(){return this.auth.signInWithPopup(this.provider)}},{key:"signOut",value:function(){return this.auth.signOut()}},{key:"getUser",value:function(){return this.auth.currentUser}}]),t}(),Q=this,V=new J("coupons"),X=new Z,Y=function(){var t=N()(I.a.mark(function t(n){var e,r,o=n.commit;return I.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,V.getAll();case 2:e=t.sent,r=[],e.forEach(function(t){var n=t.id,e=t.data(),o=["deletehash","userId"],a=G()(e).filter(function(t){return!o.includes(t)}).reduce(function(t,n){return t[n]=e[n],t},{});T()(a,{is_selected:!1},{doc_id:n}),r.push(a)}),o("STORE_COUPONS",r);case 6:case"end":return t.stop()}},t,Q)}));return function(n){return t.apply(this,arguments)}}(),$=(q=N()(I.a.mark(function t(n,e){var r,o;return I.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return x()(n),console.log(e),t.prev=2,t.next=5,V.queryById(e);case 5:return r=t.sent,o=[],r.forEach(function(t){o.push(t.data())}),t.abrupt("return",o);case 11:t.prev=11,t.t0=t.catch(2),console.error(t.t0);case 14:case"end":return t.stop()}},t,Q,[[2,11]])})),function(t,n){return q.apply(this,arguments)}),K=(B=N()(I.a.mark(function t(n,e){var r;return I.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return x()(n),t.next=3,V.addNew(e);case 3:return r=t.sent,t.abrupt("return",r);case 5:case"end":return t.stop()}},t,Q)})),function(t,n){return B.apply(this,arguments)}),tt=(H=N()(I.a.mark(function t(n){var e,r=n.commit;return I.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,X.signOut();case 3:e=t.sent,r("SET_USERINFO",e),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),r("SET_ALERTMESSAGE",t.t0);case 10:case"end":return t.stop()}},t,Q,[[0,7]])})),function(t){return H.apply(this,arguments)}),nt=(D=N()(I.a.mark(function t(n){var e,r=n.commit;return I.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,X.authWithGoogle();case 3:e=t.sent,r("SET_USERINFO",e.user),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),r("SET_ALERTMESSAGE",t.t0);case 10:case"end":return t.stop()}},t,Q,[[0,7]])})),function(t){return D.apply(this,arguments)}),et=(z=N()(I.a.mark(function t(n,e){var r,o=n.commit;return I.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.split("/"),t.prev=1,t.next=4,V.setError(r[0]);case 4:t.sent,o("SET_ALERTMESSAGE",{message:r[1]+"錯誤已回報"}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),o("SET_ALERTMESSAGE",t.t0);case 11:case"end":return t.stop()}},t,Q,[[1,8]])})),function(t,n){return z.apply(this,arguments)}),rt=function(t){var n=t.commit,e=X.getUser();e&&n("SET_USERINFO",e)};o.a.use(h.a);var ot=new h.a.Store({state:{coupons:[],login:!1,userInfomation:null,alertMessage:null},mutations:y,actions:r}),at=e("e6fC");e("Jmt5"),e("9M+g");o.a.config.productionTip=!1,o.a.use(at.a),new o.a({el:"#app",router:f,store:ot,components:{App:_},template:"<App/>"})},jFNt:function(t,n){},zj2Q:function(t,n){}},["NHnr"]);